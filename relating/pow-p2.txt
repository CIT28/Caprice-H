testing setup
the average rating of all books
┌─────────────────┐
│  AVG("rating")  │
├─────────────────┤
│ 3.8364408869645 │
└─────────────────┘
the average rating per book_id
┌─────────┬──────────────────┐
│ book_id │  average rating  │
├─────────┼──────────────────┤
│ 1       │ 3.77401943145016 │
│ 2       │ 3.97142857142857 │
│ 3       │ 3.04385964912281 │
│ 4       │ 3.56832298136646 │
│ 5       │ 4.05919796308084 │
│ 6       │ 3.76252545824847 │
│ 7       │ 3.64071856287425 │
│ 8       │ 3.8241965973535  │
│ 9       │ 3.99858156028369 │
│ 10      │ 4.04070660522273 │
│ 11      │ 4.14057800444619 │
│ 12      │ 3.61313347608851 │
│ 13      │ 3.775            │
│ 14      │ 3.71167838204464 │
│ 15      │ 3.839493458443   │
│ 16      │ 3.68502715283165 │
│ 17      │ 3.80160550458716 │
│ 18      │ 4.09376522162689 │
│ 19      │ 3.7856315179606  │
│ 20      │ 4.04264507422402 │
│ 21      │ 3.83909415971394 │
│ 22      │ 4.50104384133612 │
│ 23      │ 3.24821852731591 │
│ 24      │ 3.8003291278113  │
│ 25      │ 4.05420197740113 │
│ 26      │ 3.88723976491682 │
│ 27      │ 3.36545801526718 │
│ 28      │ 4.13681131994323 │
│ 29      │ 3.45779220779221 │
│ 30      │ 3.36418359668924 │
│ 31      │ 3.83701197870453 │
│ 32      │ 3.29473684210526 │
│ 33      │ 3.86036036036036 │
│ 34      │ 3.97821681864235 │
│ 35      │ 3.71611479028698 │
│ 36      │ 3.85012519375224 │
│ 37      │ 3.71809161342939 │
│ 38      │ 3.69173630454967 │
│ 39      │ 3.72280334728033 │
│ 40      │ 3.85580304806565 │
│ 41      │ 3.4663859392164  │
│ 42      │ 4.51125382262997 │
│ 43      │ 3.79507545671168 │
│ 44      │ 3.7432070417145  │
│ 45      │ 4.19116465863454 │
│ 46      │ 3.94621275025371 │
│ 47      │ 3.56306306306306 │
│ 48      │ 4.07711409693583 │
│ 49      │ 3.6069128902928  │
│ 50      │ 3.48184818481848 │
│ 51      │ 3.42424242424242 │
│ 52      │ 3.57865168539326 │
│ 53      │ 3.69329529243937 │
│ 54      │ 3.41684901531729 │
│ 55      │ 3.9620521782549  │
│ 56      │ 3.82022471910112 │
│ 57      │ 3.41351888667992 │
│ 58      │ 3.17669172932331 │
│ 59      │ 3.75018910741301 │
│ 60      │ 3.36531904529956 │
│ 61      │ 3.91866849691146 │
│ 62      │ 3.15822784810127 │
│ 63      │ 3.51679841897233 │
│ 64      │ 3.94525547445255 │
│ 65      │ 4.17545002368546 │
│ 66      │ 3.56863143631436 │
│ 67      │ 3.96096173733195 │
│ 68      │ 3.56756756756757 │
│ 69      │ 3.75824760553388 │
│ 70      │ 3.41433370660694 │
│ 71      │ 4.10835913312694 │
│ 72      │ 3.64936886395512 │
│ 73      │ 3.88207225630539 │
│ 74      │ 3.83141189866211 │
│ 75      │ 3.76943005181347 │
│ 76      │ 3.89371428571429 │
│ 77      │ 3.53974162469893 │
│ 78      │ 3.75584854383194 │
└─────────┴──────────────────┘
average rating per book_id rounded to 2 decimals and filtered > 4.0
┌─────────┬────────────────┐
│ book_id │ average rating │
├─────────┼────────────────┤
│ 5       │ 4.06           │
│ 10      │ 4.04           │
│ 11      │ 4.14           │
│ 18      │ 4.09           │
│ 20      │ 4.04           │
│ 22      │ 4.5            │
│ 25      │ 4.05           │
│ 28      │ 4.14           │
│ 42      │ 4.51           │
│ 45      │ 4.19           │
│ 48      │ 4.08           │
│ 65      │ 4.18           │
│ 71      │ 4.11           │
└─────────┴────────────────┘
count the number of ratings per book_id
┌─────────┬─────────────────┐
│ book_id │ COUNT("rating") │
├─────────┼─────────────────┤
│ 1       │ 2779            │
│ 2       │ 175             │
│ 3       │ 114             │
│ 4       │ 322             │
│ 5       │ 3142            │
│ 6       │ 2455            │
│ 7       │ 167             │
│ 8       │ 529             │
│ 9       │ 705             │
│ 10      │ 1302            │
│ 11      │ 7647            │
│ 12      │ 1401            │
│ 13      │ 40              │
│ 14      │ 8109            │
│ 15      │ 26217           │
│ 16      │ 5156            │
│ 17      │ 872             │
│ 18      │ 8212            │
│ 19      │ 1726            │
│ 20      │ 3705            │
│ 21      │ 839             │
│ 22      │ 479             │
│ 23      │ 1684            │
│ 24      │ 1823            │
│ 25      │ 5664            │
│ 26      │ 10039           │
│ 27      │ 2096            │
│ 28      │ 23251           │
│ 29      │ 308             │
│ 30      │ 1329            │
│ 31      │ 18032           │
│ 32      │ 95              │
│ 33      │ 1554            │
│ 34      │ 3948            │
│ 35      │ 2265            │
│ 36      │ 25161           │
│ 37      │ 7357            │
│ 38      │ 1077            │
│ 39      │ 956             │
│ 40      │ 3412            │
│ 41      │ 27310           │
│ 42      │ 16350           │
│ 43      │ 3777            │
│ 44      │ 67938           │
│ 45      │ 1245            │
│ 46      │ 10839           │
│ 47      │ 222             │
│ 48      │ 22551           │
│ 49      │ 16462           │
│ 50      │ 606             │
│ 51      │ 198             │
│ 52      │ 23852           │
│ 53      │ 1402            │
│ 54      │ 13710           │
│ 55      │ 80110           │
│ 56      │ 623             │
│ 57      │ 503             │
│ 58      │ 266             │
│ 59      │ 10576           │
│ 60      │ 2053            │
│ 61      │ 2914            │
│ 62      │ 1738            │
│ 63      │ 1012            │
│ 64      │ 2466            │
│ 65      │ 16888           │
│ 66      │ 14760           │
│ 67      │ 7736            │
│ 68      │ 592             │
│ 69      │ 5638            │
│ 70      │ 893             │
│ 71      │ 323             │
│ 72      │ 2139            │
│ 73      │ 1467            │
│ 74      │ 14052           │
│ 75      │ 772             │
│ 76      │ 12250           │
│ 77      │ 4567            │
│ 78      │ 27229           │
└─────────┴─────────────────┘
grab the average rating per book_id, only books > 4.0, order by rating desc
┌─────────┬────────────────┐
│ book_id │ average rating │
├─────────┼────────────────┤
│ 42      │ 4.51           │
│ 22      │ 4.5            │
│ 45      │ 4.19           │
│ 65      │ 4.18           │
│ 28      │ 4.14           │
│ 11      │ 4.14           │
│ 71      │ 4.11           │
│ 18      │ 4.09           │
│ 48      │ 4.08           │
│ 5       │ 4.06           │
│ 25      │ 4.05           │
│ 20      │ 4.04           │
│ 10      │ 4.04           │
└─────────┴────────────────┘
